<link rel="import" href="bower_components/iron-list/iron-list.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">

<dom-module id="anything-finder">

  <template>
    <style>
      :host {
        display: block;
        border: solid 2px red;
        padding: 1rem;
      }

      iron-list {
        border: solid 1px black;
        padding: 1rem;
      }

      paper-button {
        background: lightgreen;
        margin: 15px;
      }

      paper-input {
        display: block;
        width: 50%;
      }

      paper-spinner {
        margin-left: 45%;
        margin-bottom: 2px;
      }

      .form-search {
        display: flex;
      }

      .poster-size {
        height: 350px;
        width: 250px;
      }
      .movies-item{
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        grid-gap: 1em;
        justify-items: center;
      }
    </style>

    <iron-ajax id="searchAll" url="https://www.omdbapi.com/?s=[[film]]&plot=full&apikey=e477ed6a" handle-as="json"
      last-response="{{list}}" loading="{{loading}}" debounce-duration="300">
    </iron-ajax>

    <h2>Welcome to the [[topic]] search</h2>

    <div class="form-search">
      <paper-input label="[[topic]]" id="film" value="{{film}}"></paper-input>
      <paper-button on-click="doSearch" disabled="true" id="start" raised>Search</paper-button>
      <!-- <paper-button on-click="searchFilm" id="start" raised>Search2</paper-button> -->
    </div>

    <paper-spinner alt="loading" active="[[loading]]"></paper-spinner>

    <iron-list items="[[list.Search]]" as="film">
      <template>
          <div class="movies-item">
            <div>
              <img class="poster-size" src="[[film.Poster]]" alt="">
            </div>
            <div>
              <span>[[film.Title]] -- [[film.Year]]</span>
            </div>
          </div>
      </template>
    </iron-list>

  </template>

  <script>
    class AnythingFinder extends Polymer.Element {
      static get is() { return "anything-finder"; }
      static get properties() {
        return {
          topic: {
            type: String,
            value: 'Movie',
          },
          film: {
            type: String,
            value: '',
          },
          list: {
            type: Array,
          },
          loading: {
            type: Boolean
          }
        }
      }

      ready() {
        super.ready();
        this.$.film.addEventListener('value-changed', this._validateButton.bind(this));
      }

      doSearch() {
        if (!(this.film == '')) {
          this.$.searchAll.generateRequest();
        }
      }

      _validateButton() {
        var button = this.$.start;
        if (this.film == '') {
          button.disabled = true;
        }
        else {
          button.disabled = false;
        }
      }

      // onSearchClicked() {
      //   this.dispatchEvent(new CustomEvent('searchFilm', { composed: true, detail: { value: this.film } }));
      // }

    }
    customElements.define(AnythingFinder.is, AnythingFinder);
  </script>

</dom-module>