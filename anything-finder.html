<link rel="import" href="bower_components/iron-list/iron-list.html">
<link rel="import" href="./bower_components/paper-button/paper-button.html">
<link rel="import" href="./bower_components/paper-input/paper-input.html">
<link rel="import" href="./bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="./bower_components/iron-ajax/iron-ajax.html">

<dom-module id="anything-finder">
  <template>
    <style>
      :host {
        display: block;
        border: solid 1px red;
        padding: 1rem;
      }

      iron-list {
        border: solid 1px black;
        padding: 1rem;
        height: 100%;
        overflow: auto;
      }
      

      paper-button {
        background: lightgrey;
        margin: 15px;
      }

      paper-input {
        display: block;
        width: 50%;
      }

      paper-spinner {
        margin-left: 45%;
        margin-bottom: 2px;
      }

      .form-search {
        display: flex;
      }
      .item {
          height: 400px;
          width: 300px;
        }

        .image{
          height: 350px;
          width: 250px;
        }
    </style>

    <iron-ajax
      id="searchAll"
      url="https://www.omdbapi.com/?s=[[film]]&plot=full&apikey=e477ed6a"
      handle-as="json"
      last-response="{{list}}"
      loading="{{loading}}"
      debounce-duration="300">
    </iron-ajax>

    <p>Bienvenido al buscador de [[topic]]s</p>

    <div class="form-search">
      <paper-input label="[[topic]]"  id="film" value="{{film}}"></paper-input>
      <paper-button on-click="doSearch" disabled="true" id="start" raised>Start</paper-button>
    </div>

    <paper-spinner alt="loading" active="[[loading]]"></paper-spinner>

    <iron-list items="[[list.Search]]" as="element">
      <template>
        <div class="item">
          <div>
            <img class="image" src="[[element.Poster]]" alt="">
          </div>
          <div>
              [[element.Title]] -- [[element.Year]]
          </div>
        </div>
        
      </template>
    </iron-list>
  </template>

  <script>
    class AnythingFinder extends Polymer.Element {
      static get is() { return "anything-finder"; }
      static get properties() {
        return {
          topic: {
            type: String,
            value: 'Pelicula',
          },
          film: {
            type: String,
            value: '',
          },
          list: {
            type: Array,
          },
          loading: {
            type: Boolean
          }
        }
      }

      ready(){
        super.ready();
        this.$.film.addEventListener('value-changed', this._validateButton.bind(this));
      }

      doSearch() {
        if (!(this.film == '')) {
          this.$.searchAll.generateRequest();
        } 
      }

      _validateButton(){
        var button =this.$.start;
        if(this.film==''){
          button.disabled=true;
        }
        else{
          button.disabled=false;
        }
      }
      
    }
    customElements.define(AnythingFinder.is, AnythingFinder);
  </script>

</dom-module>